<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>隐马尔可夫模型（HMM） - ziyu&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">



  <script type="text/javascript"
        async
        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[\[','\]\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});

MathJax.Hub.Queue(function() {
    
    
    
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<style>
code.has-jax {
    font: inherit;
    font-size: 100%;
    background: inherit;
    border: inherit;
    color: #515151;
}
</style>
<meta name="generator" content="Hugo 0.80.0" /><meta property="og:site_name" content="ziyu&#39;s blog">
  <meta property="og:title" content="隐马尔可夫模型（HMM）">
  <meta property="og:description" content="隐马尔可夫模型的介绍以及在获取拷贝数变异中的应用 last update：2021-11-19">
  <meta property="description" content="隐马尔可夫模型的介绍以及在获取拷贝数变异中的应用 last update：2021-11-19">
  <meta property="og:url" content="https://taoziyu97.github.io/blog/2021-11-19_hmm/">
  <meta property="og:type" content="article">
  
    
      <meta property="og:image" content="https://i.loli.net/2021/11/19/eqhtIiLVGNgTuRb.png">
      <meta property="og:image:alt" content="Mountain Range Through Clouds">
    
  
  <link rel="stylesheet" href="/css/bundle.min.ee524de897caffec0cb74f1c397c84966cda166166488aa22fe6a4b08076ec82.css" integrity="sha256-7lJN6JfK/&#43;wMt08cOXyElmzaFmFmSIqiL&#43;aksIB27II="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    

<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          Blog
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          <a href="/" class="nav link"><i class='fa fa-home'></i> Home</a>
        
      
        
          
          <a href="/about/" class="nav link"><i class='far fa-id-card'></i> About</a>
        
      
        
          
          <a href="/categories/" class="nav link"><i class='fas fa-sitemap'></i> Categories</a>
        
      
        
          
          <a href="/book/" class="nav link"><i class='far fa-newspaper'></i> BOOK</a>
        
      
        
          
          <a href="/contact/" class="nav link"><i class='far fa-envelope'></i> Contact</a>
        
      
        
          
          <a href="/archives/" class="nav link"><i class='fa fa-newspaper'></i> Archives</a>
        
      
      <a href="#share-menu" class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      <a href="#search-input" class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    <a href="#share-menu" class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    <a href="#lang-menu" class="nav lang-toggle" lang="en">en</a>
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  <menu id="lang-menu" class="flyout-menu menu">
  <a href="#" lang="en" class="nav link active">English (en)</a>
  
    
      
    
      
        <a href="/fr" lang="fr" class="nav no-lang link">Français (fr)</a>
      
    
      
        <a href="/pl" lang="pl" class="nav no-lang link">Polski (pl)</a>
      
    
      
        <a href="/pt" lang="pt" class="nav no-lang link">Português (pt)</a>
      
    
      
        <a href="/de" lang="de" class="nav no-lang link">Deutsche (de)</a>
      
    
      
        <a href="/es" lang="es" class="nav no-lang link">Española (es)</a>
      
    
      
        <a href="/zh-cn" lang="zh-cn" class="nav no-lang link">中文 (zh-cn)</a>
      
    
      
        <a href="/zh-tw" lang="zh-tw" class="nav no-lang link">中文 (zh-tw)</a>
      
    
      
        <a href="/ja" lang="ja" class="nav no-lang link">日本語 (ja)</a>
      
    
      
        <a href="/nl" lang="nl" class="nav no-lang link">Nederlands (nl)</a>
      
    
  
</menu>

  
    <menu id="share-menu" class="flyout-menu menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89&amp;url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f&amp;title=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f&amp;title=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f&amp;description=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <p>Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Ziyu&amp;body=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="https://taoziyu97.github.io/img/main/taoziyu.jpg" class="circle" width="200" alt="Hugo Future Imperfect Slim" /></a>
  <header>
    <h1>ZIYU's Blog</h1>
  </header>
  <main>
    <p>Another fine, responsive site template by <a href='http://html5up.net'>HTML5 UP</a>.</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/taoziyu97" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>



































<li><a href="//orcid.org/https://orcid.org/0000-0003-3272-1227" target="_blank" rel="noopener" title="ORCID"><i class="ai ai-orcid"></i></a></li>



<li><a href="mailto:baomihai@sina.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article class="post">
    <header>
  <div class="title">
    
      <h2><a href="/blog/2021-11-19_hmm/">隐马尔可夫模型（HMM）</a></h2>
    
    
      <p>隐马尔可夫模型的介绍以及在获取拷贝数变异中的应用 last update：2021-11-19</p>
    
  </div>
  <div class="meta">
    <time datetime="2021-11-19 00:00:00 &#43;0000 UTC">November 19, 2021</time>
    <p>Ziyu</p>
    <p>2-Minute Read</p>
  </div>
</header>

    <div id="socnet-share">
      




  
    
    <a href="//twitter.com/share?text=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89&amp;url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f&amp;title=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f&amp;title=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f&amp;description=%e9%9a%90%e9%a9%ac%e5%b0%94%e5%8f%af%e5%a4%ab%e6%a8%a1%e5%9e%8b%ef%bc%88HMM%ef%bc%89" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <p>Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by Ziyu&amp;body=https%3a%2f%2ftaoziyu97.github.io%2fblog%2f2021-11-19_hmm%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


    </div>
    <div class="content">
      <a href="/blog/2021-11-19_hmm/" class="image" style="--bg-image: url('https://i.loli.net/2021/11/19/eqhtIiLVGNgTuRb.png');">
    <img class="stretchH" src="https://i.loli.net/2021/11/19/eqhtIiLVGNgTuRb.png" alt="Mountain Range Through Clouds">
  </a>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#引言">引言</a></li>
    <li><a href="#1-马尔可夫模型的基本概念">1. 马尔可夫模型的基本概念</a></li>
    <li><a href="#2-马尔可夫模型的组成">2. 马尔可夫模型的组成</a></li>
    <li><a href="#3-隐马尔可夫模型">3. 隐马尔可夫模型</a></li>
    <li><a href="#4-隐马尔可夫模型判断cnv">4. 隐马尔可夫模型判断CNV</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>
      <h2 id="引言">引言</h2>
<h2 id="1-马尔可夫模型的基本概念">1. 马尔可夫模型的基本概念</h2>
<p>来对2段氨基酸序列x和y进行残基比对，认为存在3种比对关系的状态：</p>
<ol>
<li>M：残基能够比对上但不一定相等</li>
<li>X：序列x的残基比对到1个空位，或x上发生了1次插入</li>
<li>Y：序列y的残基比对到1个空位，或y上发生了1次插入</li>
</ol>
<p>序列比对就是在上述3个状态中不断转换的过程：</p>
<ol>
<li>$M(i,j)$ : $x_i$比对到$y_j$时，序列x从1到$i$和序列$y$从1到$j$最好的比对分数</li>
<li>$X(i,j)$ : $x_i$比对到空位时，序列x从1到$i$最好的比对分数</li>
<li>$Y(i,j)$ : $y_j$比对到空位时，序列y从1到$j$最好的比对分数</li>
</ol>
<p>转移（从一个状态到另外一个状态）概率：</p>
<p>$$
a_{kl} = P (X_t=S_l|X_{t-1}=S_k)
$$</p>
<p>$$
a_{lk} = P (X_t=S_k|X_{t-1}=S_l)
$$</p>
<p>转移矩阵：</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/rvG7dw8BfFZO1gs.png" width="400"/>
    <p><font color="grey"></font></p>
</center>
<p>设定：</p>
<ol>
<li>$\delta$ ：Gap open（d）的概率</li>
<li>$\epsilon$ ：Gap extension（e）的概率</li>
</ol>
<center>
    <img src= "https://i.loli.net/2021/10/26/rxnmMhE87pJAZks.png" width="500"/>
    <p><font color="grey">马尔可夫链</font></p>
</center>
<p>先根据转移概率得到一个转移概率矩阵：</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/UoKdD1siZleEg5k.png" width="300"/>
    <p><font color="grey">转移矩阵</font></p>
</center>
<p>假设匹配状态是XMMY：</p>
<center>
    <img src= "https://i.loli.net/2021/10/28/LQq73aYI6HSfNAC.png" width="200"/>
    <p><font color="grey">匹配状态</font></p>
</center>
<p>计算匹配状态的概率：
$$
P(XMMY)=\alpha_{XM}\alpha_{MM}\alpha_{MY} = (1-\epsilon)(1-2\delta)\delta
$$</p>
<p>通过上面的例子，下面介绍马尔可夫模型的一些概念：</p>
<ul>
<li>
<p>马尔可夫过程：</p>
<p>马尔可夫过程是一类随机过程，该过程的“将来”仅依赖“现在”，而不依赖“过去”，把一个总随机过程看作是状态的不断转移，表达式为：
$$
x(t+1)=f(x(t))
$$</p>
</li>
<li>
<p>马尔可夫链：</p>
<p>时间和状态都离散的马尔可夫过程。</p>
</li>
<li>
<p>马尔可夫状态链的状态空间：
$$
S = \begin{Bmatrix}
S_1,&amp; S_2,&amp; S_3,&hellip;
\end{Bmatrix}S_i\in R
$$</p>
</li>
<li>
<p>马尔可夫链在时刻$t$处于状态$S_i$条件下，在时刻$t+1$转移到状态$S_j$的转移概率是条件概率：
$$
P_{ij}(t, t+1)=P\begin{Bmatrix}
x_{t+1}=S_j|x_t=S_i
\end{Bmatrix}
$$</p>
</li>
<li>
<p>由于马氏链在时刻 $t$ 从任何一个状态$S_i$出发，到下一时刻 $t+1$，必然转移到$S_j$，$j=1,2,…$，诸状</p>
<p>态中的某一个，所以有：</p>
<div>
$$
\forall _{i^{\forall}}\sum_{j}P_{ij}(t,t+1)=1
$$
</div
</li>
<li>
<p>当$P_{ij}(t,t+1)$与$t$无关时，为齐次马尔可夫链，通常说到的马尔可夫链都是指齐次的。马尔可夫链除了仅依赖于上一次观测值的一阶马尔可夫链，还可以依赖多个连续观测数据，后者称之为高阶马尔可夫链。</p>
</li>
</ul>
<h2 id="2-马尔可夫模型的组成">2. 马尔可夫模型的组成</h2>
<ul>
<li>
<p>随机序列变量
$$
X = \begin{Bmatrix}
x_1,&amp; x_2,&amp; x_3,&hellip;,x_t
\end{Bmatrix}
$$</p>
</li>
<li>
<p>状态空间
$$
S = \begin{Bmatrix}
S_1,&amp; S_2,&amp; S_3,&hellip;
\end{Bmatrix}\space\space S_i\in R \space\space\space i=1,2,&hellip;,n
$$</p>
</li>
<li>
<p>转移概率矩阵
$$
P=\begin{Bmatrix}
P_{ij}=P(x_{t+1}=S_j|x_t=S_i)
\end{Bmatrix}
$$</p>
</li>
<li>
<p>初始状态向量
$$
\prod =\begin{Bmatrix}
\pi=P(x_0=S_i)
\end{Bmatrix}
, \space\space\space i=1,2,&hellip;,n
$$</p>
</li>
</ul>
<h2 id="3-隐马尔可夫模型">3. 隐马尔可夫模型</h2>
<p>隐马尔可夫模型是结构最简单的动态贝叶斯网，可以用五元组来描述分别为：</p>
<ul>
<li>状态空间$S$</li>
<li>状态对应的观测空间$X$</li>
<li>状态转移矩阵$A$</li>
<li>每个状态下观测事件的概率矩阵$B$</li>
<li>初始状态概率分布$\pi$</li>
</ul>
<p>给出这五个参数就能够确定一个隐马尔可夫模型，通常用参数$\lambda=\begin{Bmatrix}A,B,\pi\end{Bmatrix}$来指代。</p>
<p>举一个新的例子：基因预测——给定序列预测编码区</p>
<p>隐马尔可夫模型在==状态==的基础上，增加==符号==的概念，每个状态可以以不同的概率产生可观测到的符号。在例子中，给定的基因组序列为观测到的符号串，编码和非编码为2种隐状态，即编码与否是未知的，需要通过已知的符号来推测。</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/HhznapOF2cvDXx1.png" width="700"/>
    <p><font color="grey">示例：马尔可夫链</font></p>
</center>
<p>转移矩阵：</p>
<p>基因组会同时包含编码和非编码区域，自我转移的箭头表示状态的连续。</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/yNOxact3TblZMUX.png" width="400"/>
    <p><font color="grey">转移矩阵</font></p>
</center>
<p>转移概率矩阵：</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/PUQgVykTo2NRDIb.png" width="200"/>
    <p><font color="grey">转移概率矩阵</font></p>
</center>
<p>$$
a_{kl} = P (X_t=S_l|X_{t-1}=S_k)
$$</p>
<p>生成概率：</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/Y2PRHexkO6Q5gfF.png" width="700"/>
    <p><font color="grey">生成概率</font></p>
</center>
<p>这里的状态路径无法进行观测，需要根据符号路径来推测状态，引入生成概率，状态$S_k$时产生符号$b$的概率：
$$
e_{k}(b) = P (y_i=b|X_{i}=S_k)
$$
生成概率矩阵（在这里有两个）：</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/pmXqT5jENJPLIxK.png" width="700"/>
    <p><font color="grey">2个生成概率矩阵</font></p>
</center>
<p>训练集：正确标记好了编码和非编码区域的DNA序列。</p>
<p>根据训练集填好上述转移概率矩阵和生成概率矩阵，来对未知的给定基因组序列反推最可能的基因组状态路径。</p>
<p>Logarithmic transformation：引入对数计算将乘法变成加法，对转移/生成矩阵概率取$log_{10}$（在计算机运算中，很容易因为连乘的次数的增加，很容音因为数值过小，出现下溢的问题）</p>
<p>测试序列：CGAAAAAATCG</p>
<p>根据训练集得到转移概率矩阵和生成概率矩阵：</p>
<center class="half">
    <img src="https://i.loli.net/2021/10/26/ZKzda2fiMIpyAX4.png" width="200"/><p><font color="grey">取log10的转移概率矩阵</font></p>
    <img src="https://i.loli.net/2021/10/26/i8KdCQlrASyavhR.png" width="500"/><p><font color="grey">取log10的生成概率矩阵</font></p>
</center>
<p>动态规划进行序列比对：</p>
<center>
    <img src= "https://i.loli.net/2021/10/26/3mNFbqRZkUQHLj1.png" width="600"/>
    <p><font color="grey">序列比对</font></p>
</center>
<p>假设n状态和c状态默认的分布比例分别是$log_{10}(0.8)$和$log_{10}(0.2)$，使用序列比对的方法，找到概率最大的值为起点进行回溯。最终找到的状态链为：NNCCCCCCNNN。</p>
<p>根据示例我们可以得到一个大概的步骤来对隐马尔可夫模型进行应用：</p>
<ul>
<li>首先要确定具体问题中什么是状态，什么是符号</li>
<li>其次根据状态列出转移概率矩阵，根据状态和符号列出生成概率矩阵</li>
<li>根据训练集填上矩阵的具体数值</li>
<li>根据具体问题使用相应的解决方法(本例子中根据数据来对未知的给定基因组序列反推出最可能的基因组状态路径，迭代使用动态规划进行序列比对)</li>
</ul>
<p>实际应用中关注隐马尔可夫模型的3个基本问题以及对应的解决方法：</p>
<ul>
<li>
<p>估算问题：</p>
<p>给定模型$\lambda=\begin{Bmatrix}A,B,\pi\end{Bmatrix}$，如何有效计算观测序列$x=\begin{Bmatrix} x_1,x_2,&hellip;,x_n\end{Bmatrix}$出现的概率？也就是模型和观测序列之间的匹配程度。</p>
<p>解决：foreward和backward算法</p>
</li>
<li>
<p>解码问题：</p>
<p>给定模型$\lambda=\begin{Bmatrix}A,B,\pi\end{Bmatrix}$和观测序列$x=\begin{Bmatrix} x_1,x_2,&hellip;,x_n\end{Bmatrix}$，如何找到和观测序列最匹配的状态序列？也就是找到隐藏的模型状态。</p>
<p>解决：Viterbi算法</p>
</li>
<li>
<p>学习问题或训练问题：</p>
<p>给定观测序列$x=\begin{Bmatrix} x_1,x_2,&hellip;,x_n\end{Bmatrix}$，如何调整模型参数$\lambda=\begin{Bmatrix}A,B,\pi\end{Bmatrix}$，使得该观测序列发生的概率最大？也就是根据训练样本学得最优的参数模型。</p>
<p>解决：Baum-Welch算法</p>
</li>
</ul>
<h2 id="4-隐马尔可夫模型判断cnv">4. 隐马尔可夫模型判断CNV</h2>
<p>以PennCNV为例介绍HMM在实际判断CNV中的应用。PennCNV是一个免费的检测SNP分型阵列芯片的==拷贝数变异==的工具，目前可以处理Illumina和Affymetrix array的数据来得到信号强度，若使用其他类型的SNP芯片数据和寡核苷酸芯片需要预先处理文件的格式。PennCNV使用==隐马尔可夫模型==整合<u>多个来源的信息</u>来对单个样本推断CNV。它与基于分割的算法不同，除了单独考虑信号强度外，还考虑了SNP等位基因比例分布等因素。</p>
<center>
    <img src= "https://i.loli.net/2021/10/27/fv1EkONB9oHqVwI.png" width="500"/>
    <p><font color="grey">PennCNV通过基因型来检测拷贝数变异的算法流程（Wang K et al. 2007）</font></p>
</center>
<p>在PennCNV中使用的是一阶HMM，==隐状态==是人为设定的离散值1，2，3，4，5，6，各自对应的总拷贝数数值和CNV基因型如上表所示。注意这里最大的拷贝数状态设定为拷贝数为4，因为4个和4个以上的拷贝无法进行区分。==符号==是信号强度值的两种形式：BAF和LRR。结合BAF和LRR可以判断<u>不同的拷贝数</u>以及区分出<u>拷贝中性的LOH</u>（文章中没有具体说怎么结合BAF和LRR数据的，但是通过公示我的理解是BAF和LRR同时发生的联合概率作为HMM的生成概率）。</p>
<center>
    <img src= "https://i.loli.net/2021/10/27/nvQYj1mxLXahdU5.png" width="500"/>
    <p><font color="grey">隐状态，拷贝数数值及其对应的描述（Wang K et al. 2007）</font></p>
</center>
<p>下面介绍一些定义：</p>
<ul>
<li>
<p>原始的信号强度数据需要经过“5步标准化”（http://icom.illumina.com/iom/software.ilmn），每个SNP的X值和Y值分别代表实验得到经过标准化的等位基因A和B的信号强度值，$R$为总信号强度：
$$
R = X + Y
$$</p>
</li>
<li></li>
<li>
<p>$\theta$为相对的等位信号强度比率：
$$
\theta = \frac{arctan(Y/X)}{\pi/2}
$$
该计算分母为$\pi/2$可以将数值$\theta$压缩在-1～1之间。</p>
</li>
<li>
<p>B Allele Frequency （BAF）通常指的是标准化的等位基因B和A的相对信号强度：</p>
<center>
    <img src= "https://i.loli.net/2021/10/27/MH8Tw6emP1kIuBW.png" width="600"/>
    <p><font color="grey">BAF公式（Wang K et al. 2007）</font></p>
</center>
<p>0代表只检测到了A这个allele对应的荧光信号，分型结果为AA；1代表只检测到了B这个allele对应的荧光信号，分型结果为BB；0.5代表A和B这两个allele的荧光信号强度相等，分型结果为AB。$\theta_{AA}$,$\theta_{AB}$,$\theta_{BB}$都是根据正常样本得到的值，荧光信号存在一定程度的扰动，因此BAF的取值是在0-1范围波动的值。</p>
</li>
<li>
<p>$R_{observed}$是观测值，$R_{expected}$是通过算法拟合得到的数值代表了正常样本中的信号强度，每个SNP的$log$ R 比率（LRR）：</p>
</li>
</ul>
<p>$$
LRR={log_{2}}(R_{observed}/R_{expected})
$$</p>
<p>​				LRR = 0	拷贝数为2；LRR &gt; 0    拷贝数增加；LRR &lt; 0    拷贝数减少</p>
<p>介绍完定义之后，来确定转移概率和生成概率以及对应矩阵。</p>
<ul>
<li>
<p>LRR的生成概率：</p>
<p>是混合的均匀和正态分布模型，
$$
P(r|z)=\pi_r+(1-\pi_r)\phi(r;\mu_{r,z},S_{r,z})
$$
$(\phi·；·)$是均值为$\mu_{r,z}$，标准差为$S_{r,z}$的正态分布，均匀分布用于对于芯片中随机的信号波动和可能的基因组错误注释和错误assmbly的建模。</p>
</li>
<li>
<p>BAF的生成概率：</p>
<p>对于每一个隐状态（除了状态1），有不同可能的基因型也就有不同模式的BAF。</p>
<center>
    <img src= "https://i.loli.net/2021/10/27/HBlPeryOX6Jcga3.png" width="600"/>
    <p><font color="grey">BAF生成概率（Wang K et al. 2007）</font></p>
</center>
</li>
<li>
<p>对于染色体X进行特殊处理：</p>
<p><u>将染色体X中所有的SNP的LRR值减去1个常数，使得针对女性，平均的LRR值不是0，针对男性，LRR不是单拷贝删除的LRR的参考值，因为正常的男性染色体X的状态就是state2不应该是state3。</u></p>
</li>
<li>
<p>隐状态的转移概率：</p>
<p>即两个相邻SNP发生拷贝数状态改变的概率，一般来讲，临近的SNPs拷贝数状态不太可能发生变化，但是较远的SNPs的拷贝数状态更容易发生改变。因此需要找到转移概率和距离的关系，那么转移概率为：</p>
<div>
$$
p(z_i=l|z_{i-1}=j)=\left\{\begin{matrix}
1-\sum_{k=2}^{b}p_{j,k-1}(1-e^{d_i/D}),if \space l=j \\ 
p_{j,l-1}(1-e^{d_i/D}),if \space l\neq j
\end{matrix}\right.
$$
</div
<p>$D$是一个常数，当状态为4时设为100Mb，其他状态为100kb，p是未知参数，用Baum-Welch算法进行估计，得到最优的参数后，再使用Viterbi算法进行隐状态的判断。在PennCNV的分析中，排除了所有包含小于等于2个SNP的CNV，因为这些CNV中可能存在较高的假阳性比例。</p>
</li>
</ul>
<p>介绍算法之前先定义几个概念：</p>
<ul>
<li>$O = O_1,O_2,&hellip;,O_t$		输出的观察序列符号</li>
<li>$P(O|\lambda)$ 		给定模型参数时，输出符号序列$O$的概率</li>
<li>$a_{ij}$		从状态$S_i$到状态$S_j$的转移概率</li>
<li>$b_j(O_t)$		在状态$S_j$时，输出$O_t$的概率</li>
<li>$a_t(j)$		输出部分符号序号$O = O_1,O_2,&hellip;,O_t$达到状态$S_j$时的前向概率</li>
</ul>
<p>==前向算法==：</p>
<center>
    <img src= "https://i.loli.net/2021/10/29/dWlPmjsLfUN6k1i.png" width="400"/>
    <p><font color="grey">前向算法</font></p>
</center>
<center>
    <img src= "https://i.loli.net/2021/10/29/ymVYrZazGJei2ND.png" width="600"/>
    <p><font color="grey">前向算法步骤</font></p>
</center>
<p>==Vertibi算法==</p>
<p>介绍完定义，明确完我们的五元组，我们再明确一下我们的问题是解码问题，解码问题对应的解法是Viterbi算法，介绍一下该算法具体过程：</p>
<center>
    <img src= "https://i.loli.net/2021/10/29/1eVK7QIgZunxz4M.png" width="600"/>
    <p><font color="grey">Vertibi算法步骤</font></p>
</center>
<h2 id="参考">参考</h2>
<ul>
<li><a href=""></a></li>
</ul>

    </div>
    <footer>
      <div class="stats">
  
    <ul class="categories">
      
        
          <li><a class="article-terms-link" href="/categories/%e7%94%9f%e7%89%a9%e7%bb%9f%e8%ae%a1/">生物统计</a></li>
        
      
    </ul>
  
  
    <ul class="tags">
      
        
          <li><a class="article-terms-link" href="/tags/%e7%94%9f%e7%89%a9%e7%bb%9f%e8%ae%a1/">生物统计</a></li>
        
      
    </ul>
  
</div>

    </footer>
  </article>
  
    
  
  <div id="vcomments"></div>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>

  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'OiGVbgHqcHtvLUpCg3hhcky5-gzGzoHsz',
        appKey: 'JDVkS9wP5RFaNjhV2Ccof15G',
        notify: 'false', 
        verify: 'false', 
        avatar:'mm', 
        placeholder: '说点什么吧...',
        visitor: 'true'
    });
  </script>
  
  <div class="pagination">
    
    
      <a href="/blog/2021-11-17_docall/" class="button right"><span>R：批量读入文件并合并</span></a>
    
  </div>

      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent Posts</h1>
      </header>
      
      <article class="mini-post">
          <a href="/blog/2021-11-19_hmm/" class="image" style="--bg-image: url('https://i.loli.net/2021/11/19/eqhtIiLVGNgTuRb.png');">
    <img class="stretchH" src="https://i.loli.net/2021/11/19/eqhtIiLVGNgTuRb.png" alt="Mountain Range Through Clouds">
  </a>
        <header>
          <h2><a href="/blog/2021-11-19_hmm/">隐马尔可夫模型（HMM）</a></h2>
          <time class="published" datetime="2021-11-19 00:00:00 &#43;0000 UTC">November 19, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2021-11-17_docall/" class="image" style="--bg-image: url('https://i.loli.net/2021/11/17/7Gdf5WhtenJazm1.png');">
    <img class="stretchH" src="https://i.loli.net/2021/11/17/7Gdf5WhtenJazm1.png" alt="Mountain Range Through Clouds">
  </a>
        <header>
          <h2><a href="/blog/2021-11-17_docall/">R：批量读入文件并合并</a></h2>
          <time class="published" datetime="2021-11-17 00:00:00 &#43;0000 UTC">November 17, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2021-8-31_synapser/" class="image" style="--bg-image: url('https://i.loli.net/2021/11/17/7Gdf5WhtenJazm1.png');">
    <img class="stretchH" src="https://i.loli.net/2021/11/17/7Gdf5WhtenJazm1.png" alt="Mountain Range Through Clouds">
  </a>
        <header>
          <h2><a href="/blog/2021-8-31_synapser/">synapser</a></h2>
          <time class="published" datetime="2021-07-24 00:00:00 &#43;0000 UTC">July 24, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2021-7-24_stringr_stringi/" class="image" style="--bg-image: url('https://i.loli.net/2021/11/17/7Gdf5WhtenJazm1.png');">
    <img class="stretchH" src="https://i.loli.net/2021/11/17/7Gdf5WhtenJazm1.png" alt="Mountain Range Through Clouds">
  </a>
        <header>
          <h2><a href="/blog/2021-7-24_stringr_stringi/">处理字符串的两个R包:stringi和stringr</a></h2>
          <time class="published" datetime="2021-07-24 00:00:00 &#43;0000 UTC">July 24, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
          <a href="/blog/2021-7-20_gdc_client/" class="image" style="--bg-image: url('https://i.loli.net/2021/07/20/OpPumQEXdjhMHbA.png');">
    <img class="stretchH" src="https://i.loli.net/2021/07/20/OpPumQEXdjhMHbA.png" alt="Mountain Range Through Clouds">
  </a>
        <header>
          <h2><a href="/blog/2021-7-20_gdc_client/">gdc-client</a></h2>
          <time class="published" datetime="2021-07-20 00:00:00 &#43;0000 UTC">July 20, 2021</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/blog/" class="button">See More</a>
        </footer>
      
    </section>
  

  
    

      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
          
          <li>
              <a href="/categories/%E5%8D%9A%E5%AE%A2/">博客<span class="count">6</span></a>
          
          <li>
              <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/">计算机基础<span class="count">5</span></a>
          
          <li>
              <a href="/categories/%E6%8A%80%E6%9C%AF/">技术<span class="count">4</span></a>
          
          <li>
              <a href="/categories/%E7%94%9F%E7%89%A9%E7%BB%9F%E8%AE%A1/">生物统计<span class="count">3</span></a>
          
          <li>
              <a href="/categories/bug/">bug<span class="count">1</span></a>
          
          <li>
              <a href="/categories/r%E8%AF%AD%E8%A8%80/">r语言<span class="count">1</span></a>
          
          </li>
        </ul>
      </section>
    
  

  
    <section id="mini-bio">
      <header>
        <h1>About</h1>
      </header>
      <p>This theme was developed for Hugo static site generator.</p>
      <footer>
        <a href="/about" class="button">Learn More</a>
      </footer>
    </section>
  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        <li><a href="//github.com/taoziyu97" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>



































<li><a href="//orcid.org/https://orcid.org/0000-0003-3272-1227" target="_blank" rel="noopener" title="ORCID"><i class="ai ai-orcid"></i></a></li>



<li><a href="mailto:baomihai@sina.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
  
  <p class="copyright">
    © 2021 ziyu&#39;s blog
      <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.80.0' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script><script src="/js/bundle.min.5955090a3253deadcd66071270aa2274dabe15ffc97094cec252d87b6f3f00bf.js" integrity="sha256-WVUJCjJT3q3NZgcScKoidNq&#43;Ff/JcJTOwlLYe28/AL8="></script>
    <script src="/js/add-on.js"></script>
    </div>
  </body>
</html>
